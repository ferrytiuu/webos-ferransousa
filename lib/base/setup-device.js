var async=require("async"),Table=require("easy-table"),chalk=require("chalk"),novacom=require("./novacom");
(function(){function h(a){return-1===["$","%"].indexOf(a[0])}function m(a){return a.match(/^(\d|[1-9]\d|1\d\d|2([0-4]\d|5[0-5]))\.(\d|[1-9]\d|1\d\d|2([0-4]\d|5[0-5]))\.(\d|[1-9]\d|1\d\d|2([0-4]\d|5[0-5]))\.(\d|[1-9]\d|1\d\d|2([0-4]\d|5[0-5]))$/)}function n(a){return String(a).match(/^[0-9]+$/)}function f(a,c){return c&&"function"===typeof c?a?setImmediate(c,null,a):setImmediate(c):a}function k(a,c){var l=[],d=new novacom.Resolver;async.waterfall([d.load.bind(d),d.list.bind(d),function(c,d){Array.isArray(c)&&
c.forEach(function(b){var c=b.conn.concat([]),d=b.username&&b.host&&b.port?b.username+"@"+b.host+":"+b.port:b.id,e={profile:b.profile,name:b.name,"default":b["default"],deviceinfo:{},connection:b.conn||["ssh"],details:{platform:b.type}};1===c.length&&-1!==c.indexOf("novacom")?(e.deviceinfo.uid=b.id,e.details.type=b.name.slice(0,3)):(e.deviceinfo={ip:b.host,port:String(b.port),user:b.username},e.details.password=b.password,e.details.privatekey=b.privateKeyName,e.details.passphrase=b.passphrase,e.details.description=
b.description);b.id&&(e.deviceinfo.uid=b.id,e.details.type=b.name.slice(0,3));l.push("full"===a?e:{name:b.name,"default":b["default"],info:d,connection:b.conn||"ssh",profile:b.profile})});d(l)}],function(a){f(a,c)})}var g={};"undefined"!==typeof module&&module.exports&&(module.exports=g,module.exports.isValidDeviceName=h,module.exports.isValidIpv4=m,module.exports.isValidPort=n);g.showDeviceListFull=function(a){async.waterfall([k.bind(this,"full"),function(c,a){console.log(JSON.stringify(c,null,4));
a()}],function(c){f(c,a)})};g.showDeviceList=function(a){async.waterfall([k.bind(this,"list"),function(c,a){var d=new Table;c.forEach(function(a){h(a.name)&&(d.cell("name",!0===a["default"]?a.name+chalk.green(" (default)"):a.name),d.cell("deviceinfo",a.info),d.cell("connection",a.connection),d.cell("profile",a.profile),d.newRow())});console.log(d.toString());a()}],function(c){f(c,a)})}})();
